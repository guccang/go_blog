<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– åå°ä»»åŠ¡ä¸­å¿ƒ - GUCCANG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/agent.css">
</head>
<body>
    <!-- Navigation -->
    <div class="nav-back">
        <a href="/main" class="back-btn"><i class="fas fa-home"></i> ä¸»é¡µ</a>
        <a href="/assistant" class="back-btn"><i class="fas fa-robot"></i> æ™ºèƒ½åŠ©æ‰‹</a>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-tasks"></i> åå°ä»»åŠ¡ä¸­å¿ƒ</h1>
            <p>åˆ›å»ºã€ç®¡ç†å’Œç›‘æ§æ‚¨çš„åå°æ™ºèƒ½ä»»åŠ¡</p>
        </div>

        <!-- Create Task -->
        <div class="create-task">
            <h3><i class="fas fa-plus-circle"></i> åˆ›å»ºæ–°ä»»åŠ¡</h3>
            <div class="task-input-group">
                <input type="text" id="taskInput" placeholder="è¾“å…¥ä»»åŠ¡æè¿°ï¼Œä¾‹å¦‚ï¼šåˆ†ææœ€è¿‘çš„åšå®¢è®¿é—®æ•°æ®...">
                <button onclick="createTask()">
                    <i class="fas fa-paper-plane"></i> æäº¤ä»»åŠ¡
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="icon">â³</div>
                <div class="value" id="pendingCount">0</div>
                <div class="label">å¾…æ‰§è¡Œ</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ”„</div>
                <div class="value" id="runningCount">0</div>
                <div class="label">æ‰§è¡Œä¸­</div>
            </div>
            <div class="stat-card">
                <div class="icon">âœ…</div>
                <div class="value" id="doneCount">0</div>
                <div class="label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-card">
                <div class="icon">âŒ</div>
                <div class="value" id="failedCount">0</div>
                <div class="label">å¤±è´¥</div>
            </div>
        </div>

        <!-- Task List -->
        <div class="tasks-section">
            <div class="section-header">
                <h3><i class="fas fa-list"></i> ä»»åŠ¡åˆ—è¡¨</h3>
                <button class="refresh-btn" onclick="loadTasks()">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°
                </button>
            </div>
            <div class="task-list" id="taskList">
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>æš‚æ— ä»»åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡å¼€å§‹å§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="task-modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> <span id="modalTitle">ä»»åŠ¡è¯¦æƒ…</span></h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="task-meta" id="taskMeta"></div>
                <div class="markdown-content" id="taskContent"></div>
            </div>
        </div>
    </div>

    <!-- Graph Modal -->
    <div class="task-modal" id="graphModal">
        <div class="modal-content graph-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-project-diagram"></i> <span id="graphTitle">ä»»åŠ¡æ‰§è¡Œå›¾</span></h3>
                <div class="graph-stats" id="graphStats"></div>
                <button class="modal-close" onclick="closeGraphModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body graph-body">
                <div class="graph-container">
                    <div class="graph-diagram" id="graphDiagram">
                        <p style="color: var(--text-muted);">åŠ è½½ä¸­...</p>
                    </div>
                    <div class="graph-sidebar">
                        <div class="log-filters">
                            <button class="log-filter-btn active" data-level="all" onclick="filterLogs('all')">å…¨éƒ¨</button>
                            <button class="log-filter-btn" data-level="info" onclick="filterLogs('info')">ä¿¡æ¯</button>
                            <button class="log-filter-btn" data-level="warn" onclick="filterLogs('warn')">è­¦å‘Š</button>
                            <button class="log-filter-btn" data-level="error" onclick="filterLogs('error')">é”™è¯¯</button>
                        </div>
                        <div class="graph-logs" id="graphLogs">
                            <p class="empty-logs">æš‚æ— æ‰§è¡Œæ—¥å¿—</p>
                        </div>
                        <div class="node-detail-panel" id="nodeDetailPanel"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Input Modal -->
    <div class="input-modal" id="inputModal">
        <div class="input-modal-content">
            <div class="input-modal-header">
                <div class="icon">â“</div>
                <h3 id="inputTitle">è¯·è¾“å…¥</h3>
            </div>
            <div class="input-modal-body">
                <div class="input-message" id="inputMessage"></div>
                <div class="input-form-group" id="inputFormGroup">
                    <!-- åŠ¨æ€ç”Ÿæˆè¾“å…¥æ§ä»¶ -->
                </div>
            </div>
            <div class="input-modal-footer" id="inputFooter">
                <button class="input-cancel-btn" onclick="cancelInput()">å–æ¶ˆ</button>
                <button class="input-submit-btn" onclick="submitInput()">ç¡®è®¤æäº¤</button>
            </div>
        </div>
    </div>

    <!-- WebSocket Status -->
    <div class="ws-status">
        <div class="ws-indicator" id="wsIndicator"></div>
        <span id="wsStatusText">æœªè¿æ¥</span>
    </div>

    <!-- External Scripts -->
    <script src="/js/marked/marked.min.js"></script>
    <script src="/js/agent_notifier.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#6366f1',
                primaryTextColor: '#f8fafc',
                primaryBorderColor: '#4f46e5',
                lineColor: '#94a3b8',
                secondaryColor: '#1e293b',
                tertiaryColor: '#0f172a',
                background: '#1e293b',
                fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
    </script>
    <script src="/js/agent.js"></script>
</body>
</html>
