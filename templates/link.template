<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title> GUCCANG/LINK </title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    	<link rel="stylesheet" href="/css/link.css">
	</head>

	<body>
		<div class="top-sidebar-cotainer">
		  <div class="top-sidebar" >
			<div class="nav-container">
				<a href="/main">
					<div class="img-cycle">G</div>
				</a>
				<a href="/editor" class="nav-item"><span class="nav-icon">ğŸ“</span><span class="nav-text">åˆ›å»ºåšå®¢</span></a>
				<a href="/todolist" class="nav-item" onclick="navigateToTodolist(event)"><span class="nav-icon">âœ…</span><span class="nav-text">æ¯æ—¥ä»»åŠ¡</span></a>
				<a href="/monthgoal" class="nav-item"><span class="nav-icon">ğŸ“…</span><span class="nav-text">æœˆåº¦è®¡åˆ’</span></a>
				<a href="/yearplan" class="nav-item"><span class="nav-icon">ğŸ“†</span><span class="nav-text">å¹´åº¦è®¡åˆ’</span></a>
				<a href="/exercise" class="nav-item"><span class="nav-icon">ğŸ’ª</span><span class="nav-text">é”»ç‚¼ç®¡ç†</span></a>
				<a href="/reading" class="nav-item"><span class="nav-icon">ğŸ“š</span><span class="nav-text">è¯»ä¹¦è®°å½•</span></a>
				<a href="/skill" class="nav-item"><span class="nav-icon">ğŸ¯</span><span class="nav-text">æŠ€èƒ½å­¦ä¹ </span></a>
				<a href="/taskbreakdown" class="nav-item"><span class="nav-icon">ğŸ“‹</span><span class="nav-text">ä»»åŠ¡æ‹†è§£</span></a>
				<a href="/lifecountdown" class="nav-item"><span class="nav-icon">â°</span><span class="nav-text">äººç”Ÿå€’è®¡æ—¶</span></a>
				<a href="/statistics" class="nav-item"><span class="nav-icon">ğŸ“Š</span><span class="nav-text">è®¿é—®ç»Ÿè®¡</span></a>
				<a href="/tools" class="nav-item"><span class="nav-icon">ğŸ› ï¸</span><span class="nav-text">å®ç”¨å·¥å…·</span></a>
				<a href="/config" class="nav-item"><span class="nav-icon">ğŸ”§</span><span class="nav-text">ç³»ç»Ÿé…ç½®</span></a>
				<a href="/agent" class="nav-item"><span class="nav-icon">ğŸ¤–</span><span class="nav-text">Agent</span></a>
				<a href="/codegen" class="nav-item"><span class="nav-icon">ğŸ’»</span><span class="nav-text">ç¼–ç åŠ©æ‰‹</span></a>
				<a href="/public?account={{.USER_ACCOUNT}}" class="nav-item"><span class="nav-icon">ğŸŒ</span><span class="nav-text">å…¬å¼€åšå®¢</span></a>
			</div>
			<div class="search-toggle-container">
				<div class="search-container">
					<input id="search" type="text" placeholder="æœç´¢åšå®¢æˆ–æ ‡ç­¾..." list="search_list">
				<datalist id="search_list">
					<!-- æ ‡ç­¾å»ºè®® -->
					{{range .TAGS}}
						<option>{{.Name}}</option>
					{{end}}
					<!-- æœç´¢å‘½ä»¤å»ºè®® -->
					<option>@tag match </option>
					<option>@auth match public</option>
					<option>@auth match private</option>
					<option>@auth match encrypt</option>
					<option>@timed match </option>
					<option>@reload cfg</option>
				</datalist>
					<button type="button" class="search-btn" onclick="onSearch()">æœç´¢</button>
					<select id="search-command-select" class="search-command-select" title="é€‰æ‹©æœç´¢å‘½ä»¤">
						<option value="">é€‰æ‹©å‘½ä»¤</option>
						{{range .SEARCH_COMMANDS}}
						<option value="{{.Name}}" data-hasparam="{{.HasParam}}" data-paramhint="{{.ParamHint}}">{{.DisplayName}}</option>
						{{end}}
					</select>
				</div>
				<div class="header-actions">
					<button class="view-toggle" onclick="toggleView()" title="åˆ‡æ¢è§†å›¾">
						<i id="view-icon">ğŸ“‘</i>
						<span id="view-text">ç½‘æ ¼è§†å›¾</span>
					</button>
					<div class="user-info">
						<div class="user-avatar">{{.USER_AVATAR}}</div>
						<a href="/account" class="user-name" style="color: inherit; text-decoration: none; cursor: pointer;" title="ç‚¹å‡»æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯">{{.USER_ACCOUNT}}</a>
					</div>
				</div>
			</div>
		  </div>
		</div>

		<!-- æœ€è¿‘æŸ¥çœ‹åŒºåŸŸ -->
		<div class="recent-section">
			<h2 class="section-title">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 5px;">
					<path d="M12 7V12L16 14M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				æœ€è¿‘æŸ¥çœ‹
			</h2>
			<div class="recent-container">
			{{if .RECENT_LINKS}}
				{{range .RECENT_LINKS}}
					<div class="recent-card-circle">
						<a href="{{.URL}}" class="circle-link">
							<div class="circle-avatar">
								<span class="circle-text" data-title="{{.DESC}}"></span>
							</div>
							<span class="circle-title">
								{{if .IS_ENCRYPTED}}<span class="encrypt-lock">ğŸ”’</span>{{end}}{{if .IS_DIARY}}<span class="diary-icon">ğŸ“”</span>{{end}}{{.DESC}}
							</span>
						</a>
					</div>
				{{end}}
			{{else}}
				<div class="empty-recent">æš‚æ— æœ€è¿‘æŸ¥çœ‹è®°å½•</div>
			{{end}}
			</div>
		</div>
	</div>


	<!-- çƒ­é—¨æ ‡ç­¾åŒºåŸŸ -->
	<div class="tags-section">
		<h2 class="section-title">
			<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 5px;">
				<path d="M20.59 13.41L13.42 20.58C13.2343 20.7657 13.0137 20.9134 12.7709 21.0148C12.5281 21.1162 12.2678 21.1693 12.005 21.171C11.7422 21.1727 11.4813 21.123 11.2368 21.0248C10.9923 20.9266 10.7691 20.7818 10.58 20.598L3 13V3H13L20.59 10.59C20.9625 10.9645 21.1716 11.4716 21.1716 12C21.1716 12.5284 20.9625 13.0355 20.59 13.41Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
			çƒ­é—¨æ ‡ç­¾
		</h2>
		<div class="tags-container" id="tagsContainer">
			<div class="tag-filters" id="tagFilters">
				{{range .TAGS}}
					<button type="button" class="tag-filter {{if ge .Count 10}}tag-size-large{{else if ge .Count 5}}tag-size-medium{{else}}tag-size-small{{end}}" data-tag="{{.Name}}" data-count="{{.Count}}" onclick="searchByTag('{{.Name}}')">{{.Name}} ({{.Count}})</button>
				{{end}}
			</div>
			<div class="tags-toggle-btn" id="tagsToggleBtn" onclick="toggleTags()">
				<span id="tagsToggleText">å±•å¼€æ›´å¤š</span>
				<i class="fas fa-chevron-down" id="tagsToggleIcon"></i>
			</div>
		</div>
	</div>

	<script>
	function toggleTags() {
		const container = document.getElementById('tagsContainer');
		const btnText = document.getElementById('tagsToggleText');
		const btnIcon = document.getElementById('tagsToggleIcon');
		
		if (container.classList.contains('expanded')) {
			container.classList.remove('expanded');
			btnText.textContent = 'å±•å¼€æ›´å¤š';
			btnIcon.className = 'fas fa-chevron-down';
		} else {
			container.classList.add('expanded');
			btnText.textContent = 'æ”¶èµ·æ ‡ç­¾';
			btnIcon.className = 'fas fa-chevron-up';
		}
	}

	// æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºå±•å¼€æŒ‰é’®
	document.addEventListener('DOMContentLoaded', function() {
		const filters = document.getElementById('tagFilters');
		const btn = document.getElementById('tagsToggleBtn');
		// å¦‚æœæ ‡ç­¾é«˜åº¦è¶…è¿‡ä¸€å®šå€¼ï¼ˆæ¯”å¦‚100pxï¼‰ï¼Œæ˜¾ç¤ºæŒ‰é’®ï¼Œå¦åˆ™éšè—
		if (filters.scrollHeight <= 100) {
			btn.style.display = 'none';
		}
	});
	</script>

	<div class="container">
		{{range .LINKS}}
			<div class="link-card">
				<a class="link-with-dot" href="{{.URL}}">
				{{if .IS_ENCRYPTED}}<span class="encrypt-lock">ğŸ”’</span>{{end}}{{if .IS_DIARY}}<span class="diary-icon">ğŸ“”</span>{{end}}{{.DESC}}
				</a>
			</div>
		{{end}}
		</div>

		<a href="/editor" class="create-btn" title="åˆ›å»ºæ–°åšå®¢">+</a>
		
		<!-- æ™ºèƒ½åŠ©æ‰‹æ‚¬æµ®å›¾æ ‡ -->
		<a href="/assistant" class="assistant-floating-btn" title="æ™ºèƒ½åŠ©æ‰‹">
			<i class="fas fa-robot"></i>
		</a>	

		<div class="bottom-fix-div">
		<span class="right-label">åšå®¢æ•°é‡: {{.BLOGS_NUMBER}}</span>
		<span class="right-label">ç‰ˆæœ¬: {{.VERSION}}</span>
		</div>

    	<script src="/js/move_assistant.js"></script>
		<script src="/js/utils.js"></script>
		<script src="/js/link.js"></script>
		<script src="/js/global-reminder.js"></script>

		<script>
		// ç‚¹å‡»æ ‡ç­¾è¿›è¡Œæœç´¢
		function searchByTag(tagName) {
			const searchInput = document.getElementById('search');
			if (searchInput) {
				searchInput.value = "@tag match " + tagName;
				onSearch();
			}
		}

		// å¡«å……æœç´¢å‘½ä»¤åˆ°æœç´¢æ¡†
		function fillSearchCommand(commandOrButton) {
			const searchInput = document.getElementById('search');
			if (!searchInput) return;

			let command = '';
			let hasParam = false;
			let paramHint = '';

			if (typeof commandOrButton === 'string') {
				// å‘åå…¼å®¹ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å­—ç¬¦ä¸²
				command = commandOrButton;
				hasParam = command.endsWith(' ');
			} else {
				// æ–°æ–¹å¼ï¼šä»æŒ‰é’®å…ƒç´ è·å–æ•°æ®
				const button = commandOrButton;
				command = button.getAttribute('data-command');
				hasParam = button.getAttribute('data-hasparam') === 'true';
				paramHint = button.getAttribute('data-paramhint') || '';

				// å¦‚æœå‘½ä»¤éœ€è¦å‚æ•°ï¼Œæ·»åŠ ç©ºæ ¼
				if (hasParam) {
					command += ' ';
				}
			}

			searchInput.value = command;
			searchInput.focus();

			// å¦‚æœå‘½ä»¤éœ€è¦é¢å¤–å‚æ•°ï¼Œå°†å…‰æ ‡å®šä½åˆ°å‘½ä»¤æœ«å°¾
			if (hasParam) {
				searchInput.setSelectionRange(command.length, command.length);
				// æ˜¾ç¤ºå‚æ•°æç¤º
				if (paramHint) {
					showCommandHint(`è¯·è¾“å…¥${paramHint}`);
				}
			} else {
				// ä¸éœ€è¦å‚æ•°çš„å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œæœç´¢
				setTimeout(() => {
					if (searchInput.value === command) {
						onSearch();
					}
				}, 100);
			}
		}

		// æ˜¾ç¤ºå‘½ä»¤æç¤º
		function showCommandHint(message) {
			// åˆ›å»ºæˆ–æ›´æ–°æç¤ºå…ƒç´ 
			let hintEl = document.getElementById('search-command-hint');
			if (!hintEl) {
				hintEl = document.createElement('div');
				hintEl.id = 'search-command-hint';
				hintEl.style.cssText = `
					position: fixed;
					top: 100px;
					right: 20px;
					background: #4CAF50;
					color: white;
					padding: 10px 15px;
					border-radius: 5px;
					box-shadow: 0 2px 10px rgba(0,0,0,0.2);
					z-index: 1000;
					font-size: 14px;
					animation: fadeIn 0.3s;
				`;
				document.body.appendChild(hintEl);
			}

			hintEl.textContent = message;

			// 3ç§’åè‡ªåŠ¨éšè—
			setTimeout(() => {
				if (hintEl.parentNode) {
					hintEl.style.animation = 'fadeOut 0.3s';
					setTimeout(() => {
						if (hintEl.parentNode) {
							hintEl.parentNode.removeChild(hintEl);
						}
					}, 300);
				}
			}, 3000);
		}

		// å¤„ç†æœç´¢å‘½ä»¤é€‰æ‹©
		function handleSearchCommandSelect() {
			const select = document.getElementById('search-command-select');
			if (!select) return;

			const selectedOption = select.options[select.selectedIndex];
			if (!selectedOption || !selectedOption.value) return;

			const command = selectedOption.value;
			const hasParam = selectedOption.getAttribute('data-hasparam') === 'true';
			const paramHint = selectedOption.getAttribute('data-paramhint') || '';

			const searchInput = document.getElementById('search');
			if (!searchInput) return;

			// å¡«å……å‘½ä»¤åˆ°è¾“å…¥æ¡†
			let commandText = command;
			if (hasParam) {
				commandText += ' ';
			}

			searchInput.value = commandText;
			searchInput.focus();

			// å¦‚æœå‘½ä»¤éœ€è¦é¢å¤–å‚æ•°ï¼Œå°†å…‰æ ‡å®šä½åˆ°å‘½ä»¤æœ«å°¾
			if (hasParam) {
				searchInput.setSelectionRange(commandText.length, commandText.length);
				// æ˜¾ç¤ºå‚æ•°æç¤º
				if (paramHint) {
					showCommandHint(`è¯·è¾“å…¥${paramHint}`);
				}
			} else {
				// ä¸éœ€è¦å‚æ•°çš„å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œæœç´¢
				setTimeout(() => {
					if (searchInput.value === commandText) {
						onSearch();
					}
				}, 100);
			}

			// é‡ç½®é€‰æ‹©å™¨åˆ°é»˜è®¤é€‰é¡¹
			setTimeout(() => {
				select.selectedIndex = 0;
			}, 10);
		}

		// åˆå§‹åŒ–æœç´¢å‘½ä»¤é€‰æ‹©å™¨äº‹ä»¶
		document.addEventListener('DOMContentLoaded', function() {
			const searchCommandSelect = document.getElementById('search-command-select');
			if (searchCommandSelect) {
				searchCommandSelect.addEventListener('change', handleSearchCommandSelect);
			}
		});

		// æ·»åŠ CSSåŠ¨ç”»
		const style = document.createElement('style');
		style.textContent = `
			@keyframes fadeIn {
				from { opacity: 0; transform: translateY(-10px); }
				to { opacity: 1; transform: translateY(0); }
			}
			@keyframes fadeOut {
				from { opacity: 1; transform: translateY(0); }
				to { opacity: 0; transform: translateY(-10px); }
			}
			.tag-hidden {
				display: none !important;
			}
			.toggle-btn {
				background-color: var(--secondary-color);
				color: var(--text-color);
				border: 1px dashed var(--border-color);
			}
			.toggle-btn:hover {
				background-color: var(--accent-color);
				color: white;
				border-color: var(--accent-color);
			}
		`;
		document.head.appendChild(style);

		// æ ‡ç­¾æŠ˜å åŠŸèƒ½
		document.addEventListener('DOMContentLoaded', function() {
			const MAX_VISIBLE_TAGS = 20;
			const tagContainer = document.querySelector('.tag-filters');
			if (!tagContainer) return;

			const tags = tagContainer.querySelectorAll('.tag-filter:not(.toggle-btn)');
			const totalTags = tags.length;

			if (totalTags <= MAX_VISIBLE_TAGS) return;

			// åˆ›å»ºåˆ‡æ¢æŒ‰é’®
			const toggleBtn = document.createElement('button');
			toggleBtn.className = 'tag-filter toggle-btn';
			toggleBtn.innerHTML = 'å±•å¼€æ›´å¤š <i class="fas fa-chevron-down"></i>';
			toggleBtn.onclick = function() {
				const isExpanded = toggleBtn.getAttribute('data-expanded') === 'true';
				if (isExpanded) {
					// æ”¶èµ·
					tags.forEach((tag, index) => {
						if (index >= MAX_VISIBLE_TAGS) {
							tag.classList.add('tag-hidden');
						}
					});
					toggleBtn.innerHTML = 'å±•å¼€æ›´å¤š <i class="fas fa-chevron-down"></i>';
					toggleBtn.setAttribute('data-expanded', 'false');
				} else {
					// å±•å¼€
					tags.forEach(tag => {
						tag.classList.remove('tag-hidden');
					});
					toggleBtn.innerHTML = 'æ”¶èµ· <i class="fas fa-chevron-up"></i>';
					toggleBtn.setAttribute('data-expanded', 'true');
				}
			};

			// åˆå§‹éšè—å¤šä½™æ ‡ç­¾
			tags.forEach((tag, index) => {
				if (index >= MAX_VISIBLE_TAGS) {
					tag.classList.add('tag-hidden');
				}
			});

			// æ·»åŠ æŒ‰é’®åˆ°å®¹å™¨æœ«å°¾
			tagContainer.appendChild(toggleBtn);
		});
		</script>
		
	</body>
</html>
